---
layout: post
title: "NDepend"
---

<p>A while ago, I received an e-mail from <a href="http://codebetter.com/patricksmacchia/">Patrick Smacchia</a>, offering me a license for <a href="http://www.ndepend.com/">NDepend</a> and asking me whether I could try it out, give some feedback and if I liked it, maybe I could blog about my experience with NDepend. Because I was already subscribed to the RSS-feed of Patrick’s blog, I knew about NDepend and how it could help developers write better code. I like trying out stuff like this, but somehow I hadn’t found time to install and properly test it. I was already using Visual Studio’s Code Analysis (FxCop) and <a href="https://stylecop.codeplex.com/">StyleCop</a> to analyze my code and improve its quality, so I never had the right incentives to use additional tools. But it would be rude to just say no to Patrick, so I decided to give it a try.

<p>After installing it (which just means downloading: NDepend is a portable application that doesn’t really have to be “installed”), I started Visual NDepend (the GUI version of NDepend) and was greeted with a start page that looks like the Visual Studio start page. I decided not to just jump in and try stuff, but to first watch some of the <a href="http://www.ndepend.com/docs/getting-started-with-ndepend">screen casts and tutorials on the NDepend website</a>. And I’m glad I did. After trying to analyze some of my projects, I discovered that NDepend produces a lot of data, reports and graphs that only make sense after you have learnt what it all means. This is a tool that you have to learn how to use and how to interpret its results. The user interface is very flexible, but also a bit overwhelming. But because I don’t really have an idea how I would design a UI for an application like this, I can’t really criticize it.

<p>Comparing it to FxCop and StyleCop is not really fair. There is some overlapping functionality between the 3 tools, but NDepend offers a lot more. First of all, FxCop and StyleCop just analyze your code according to fixed rules and the result is a bunch of errors and warnings. NDepend can also be used like this, but the rules are not fixed and are defined in CQL, a query language that looks and feels like SQL, but allows you to query code constructs. The advantage of this approach is that you can write ad-hoc queries to gain insight in your code (or someone else’s assemblies). Here’s an example of a CQL query:

<pre><code>WARN IF Count &gt; 0 IN SELECT TOP 10 TYPES WHERE NbMethods &gt; 20 ORDER BY NbMethods DESC</code></pre>

<p>This query will generate a warning if your code has classes (and structs) with more than 20 methods. All the built-in rules are written as CQL queries, which you can just modify (or you could just create additional rules).

<p>Another area of analysis that NDepend offers that FxCop and StyleCop do not have is the visual views of your projects. There’s a metrics {% include wikipedia-link.html term="Treemapping" label="treemap" %} that shows the proportions of different metrics of your project (methods, types, fields, …) and there are 2 ways to show dependencies: a {% include wikipedia-link.html term="Dependency graph" label="dependency graph" %} and a {% include wikipedia-link.html term="Design structure matrix" label="dependency matrix" %}. While the dependency graph looks familiar and very graphical, it fails when there are too many elements and dependencies. This is not a failure of NDepend, but just a limitation of dependency graphs in general. Dependency matrices on the other hand are great to understand dependencies, even when there are a lot of elements, but they are less intuitive and you have to learn how to use them and interpret what you see.

<p>My conclusion is that NDepend is a great tool to analyze your code and improve its quality, but it takes getting used to. You have to learn how to use it and how to interpret the results you get. I feel like I have just seen the tip of the iceberg. NDepend also contains a console-application, and can be automated and integrated in your build process (MSBuild, NAnt, …). It has add-ins for Visual Studio and Reflector, and can be used to compare different versions of a code base (for example: to see if compatibility is broken).

<p>If you want to try it yourself, I suggest you first <a href="http://www.ndepend.com/docs/getting-started-with-ndepend">watch the screen casts</a>, <a href="http://www.ndepend.com/download">download NDepend</a> and start analyzing some of your projects. Another suggestion I have is to start reading <a href="http://codebetter.com/patricksmacchia/">Patrick Smacchia’s blog</a>, because he has written about some cool things you can do with NDepend. He also explains how he has analyzed some existing .NET applications (<a href="http://codebetter.com/patricksmacchia/2008/10/20/controlling-the-usage-of-libraries/">Paint.NET</a>, <a href="http://codebetter.com/patricksmacchia/2009/07/21/nhibernate-2-1-changes-overview/">NHibernate</a>, <a href="http://codebetter.com/patricksmacchia/2009/04/26/the-big-picture-of-the-sharpdevelop-code-base/">SharpDevelop</a>, …) and even how he uses NDepend to find what has changed between <a href="http://codebetter.com/patricksmacchia/2009/10/21/interesting-findings-in-the-diff-between-net-fx-v4-beta1-and-beta2/">different versions of the .NET Framework BCL</a>.